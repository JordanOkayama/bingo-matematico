<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bingo Matemático</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    body{background:linear-gradient(135deg,#6a11cb 0%,#2575fc 100%);min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:20px;color:#333}
    .container{width:100%;max-width:1200px;background:#fff;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.2);overflow:hidden;margin:20px 0}
    header{background:#4A90E2;color:#fff;text-align:center;padding:20px}
    h1{font-size:2.5rem;margin-bottom:10px}
    .subtitle{font-size:1.2rem;opacity:.9}
    .content{padding:30px}
    .screen{display:none}
    .active{display:block}
    .home-buttons{display:flex;flex-direction:column;gap:20px;align-items:center;margin-top:40px}
    .btn{padding:15px 40px;font-size:1.2rem;border:none;border-radius:50px;cursor:pointer;transition:all .3s ease;font-weight:bold;display:inline-block;text-align:center;text-decoration:none;box-shadow:0 4px 8px rgba(0,0,0,.1)}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn-primary{background:#4A90E2;color:#fff}
    .btn-primary:hover{background:#357ABD;transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.15)}
    .btn-secondary{background:#50C878;color:#fff}
    .btn-secondary:hover{background:#3DAF64;transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.15)}
    .btn-tertiary{background:#FF6B6B;color:#fff}
    .btn-tertiary:hover{background:#E55C5C;transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.15)}
    .form-group{margin-bottom:20px}
    label{display:block;margin-bottom:8px;font-weight:bold;color:#444}
    input,select{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:1rem}
    input:focus,select:focus{border-color:#4A90E2;outline:none}
    .checkbox-group{display:flex;flex-wrap:wrap;gap:15px;margin:15px 0}
    .checkbox-item{display:flex;align-items:center;gap:8px}
    .card-preview{display:grid;grid-template-columns:repeat(5,1fr);gap:5px;margin:20px 0;max-width:300px}
    .card-cell{background:#f8f8f8;border:1px solid #ddd;border-radius:5px;padding:10px;text-align:center;font-weight:bold;height:50px;display:flex;align-items:center;justify-content:center}
    .card-cell.free{background:#4A90E2;color:#fff}
    .actions{display:flex;justify-content:center;gap:15px;margin-top:30px;flex-wrap:wrap}
    .cartelas-container{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin:20px 0}
    .cartela{border:2px solid #4A90E2;border-radius:10px;padding:15px;background:#fff}
    .cartela h3{text-align:center;margin-bottom:10px;color:#4A90E2}
    .game-container{display:flex;flex-direction:column;align-items:center;gap:20px}
    .number-display{font-size:5rem;font-weight:bold;color:#4A90E2;background:#f0f0f0;border-radius:15px;padding:20px 40px;margin:20px 0;box-shadow:0 5px 15px rgba(0,0,0,.1);min-width:200px;text-align:center}
    .operation-display{font-size:2rem;color:#555;margin-bottom:10px;min-height:60px;text-align:center;padding:10px;background:#f9f9f9;border-radius:10px;width:100%;max-width:600px}
    .drawn-expressions{display:flex;flex-direction:column;gap:10px;margin:20px 0;max-width:600px;max-height:300px;overflow-y:auto;padding:10px;border:2px solid #4A90E2;border-radius:10px;width:100%}
    .drawn-expression{background:#f8f8f8;padding:10px;border-radius:5px;text-align:center;font-weight:bold}
    .verifier{margin-top:20px;padding:20px;border:2px solid #4A90E2;border-radius:10px;background:#f8f8f8;width:100%;max-width:500px}
    .verifier-input{display:flex;gap:10px;margin-top:10px}
    .verifier-input input{flex:1}
    .verifier-result{margin-top:15px;padding:10px;border-radius:5px;text-align:center;font-weight:bold}
    .verifier-result.valid{background:#d4edda;color:#155724}
    .verifier-result.invalid{background:#f8d7da;color:#721c24}
    .difficulty-group{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
    .game-layout{display:grid;grid-template-columns:1fr 1fr;gap:30px;width:100%}
    .game-main{display:flex;flex-direction:column;align-items:center}
    .game-sidebar{display:flex;flex-direction:column}
    @media (max-width:968px){.game-layout{grid-template-columns:1fr}}
    @media (max-width:768px){
      .difficulty-group{grid-template-columns:1fr}
      .cartelas-container{grid-template-columns:1fr}
      .btn{padding:12px 30px;font-size:1.1rem}
      .number-display{font-size:3.5rem;padding:15px 30px}
      .game-layout{grid-template-columns:1fr}
    }
    .history-title{text-align:center;margin-bottom:10px}
    .info-text{background:#f0f7ff;padding:15px;border-radius:8px;margin:15px 0;border-left:4px solid #4A90E2}
    .pdf-preview{margin:20px 0;padding:15px;border:2px dashed #4A90E2;border-radius:10px;background:#f9f9f9}
    .pdf-cards{display:grid;grid-template-columns:repeat(2,1fr);gap:15px}
    .pdf-card{border:1px solid #ccc;border-radius:5px;padding:10px;background:#fff}
    .pdf-card h4{text-align:center;margin-bottom:5px;color:#4A90E2}
    .pdf-card-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:3px}
    .pdf-cell{border:1px solid #ddd;border-radius:3px;padding:5px;text-align:center;font-size:.8rem;height:30px;display:flex;align-items:center;justify-content:center}
    .pdf-cell.free{background:#4A90E2;color:#fff}
    .warn{margin-top:8px;font-size:.95rem;color:#a94442;background:#f2dede;border:1px solid #ebccd1;border-radius:6px;padding:10px;display:none}
    .ok{margin-top:8px;font-size:.95rem;color:#155724;background:#d4edda;border:1px solid #c3e6cb;border-radius:6px;padding:10px;display:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Bingo Matemático</h1>
      <p class="subtitle">Aprenda matemática de forma divertida!</p>
    </header>

    <div class="content">
      <!-- Tela Inicial -->
      <div id="home-screen" class="screen active">
        <h2>Bem-vindo ao Bingo Matemático</h2>
        <p>Escolha uma das opções abaixo para começar:</p>

        <div class="home-buttons">
          <button class="btn btn-primary" onclick="showScreen('generate-screen')">Gerar Cartelas</button>
          <button class="btn btn-secondary" onclick="showScreen('config-screen')">Começar</button>
        </div>

        <div style="margin-top: 40px; text-align: center;">
          <h3>Como funciona?</h3>
          <p>O Bingo Matemático ajuda os alunos a praticarem as quatro operações básicas de forma divertida.</p>
          <p>Gere cartelas personalizadas ou inicie um jogo com suas configurações preferidas.</p>
        </div>
      </div>

      <!-- Tela de Geração de Cartelas -->
      <div id="generate-screen" class="screen">
        <h2>Gerar Cartelas</h2>
        <p>Preencha as informações abaixo para gerar as cartelas de bingo.</p>

        <div class="form-group">
          <label for="min-number">Número Mínimo:</label>
          <input type="number" id="min-number" value="1" min="1">
        </div>

        <div class="form-group">
          <label for="max-number">Número Máximo:</label>
          <input type="number" id="max-number" value="50" min="2">
          <div id="range-warn" class="warn"></div>
          <div id="range-ok" class="ok"></div>
        </div>

        <div class="form-group">
          <label for="card-count">Quantidade de Cartelas:</label>
          <input type="number" id="card-count" value="4" min="1" max="200">
        </div>

        <h3>Pré-visualização da Cartela:</h3>
        <div class="card-preview" id="card-preview-grid">
          <!-- 25 células (FREE no meio) -->
          <div class="card-cell">1</div><div class="card-cell">2</div><div class="card-cell">3</div><div class="card-cell">4</div><div class="card-cell">5</div>
          <div class="card-cell">6</div><div class="card-cell">7</div><div class="card-cell">8</div><div class="card-cell">9</div><div class="card-cell">10</div>
          <div class="card-cell">11</div><div class="card-cell">12</div><div class="card-cell free">FREE</div><div class="card-cell">14</div><div class="card-cell">15</div>
          <div class="card-cell">16</div><div class="card-cell">17</div><div class="card-cell">18</div><div class="card-cell">19</div><div class="card-cell">20</div>
          <div class="card-cell">21</div><div class="card-cell">22</div><div class="card-cell">23</div><div class="card-cell">24</div><div class="card-cell">25</div>
        </div>

        <div class="actions">
          <button id="btn-generate" class="btn btn-primary" onclick="generateCards()">Gerar Cartelas</button>
          <button class="btn btn-secondary" onclick="showScreen('home-screen')">Voltar</button>
        </div>

        <div id="generated-cards" style="display:none;">
          <h3>Suas cartelas foram geradas!</h3>
          <div class="pdf-preview">
            <h4>Pré-visualização do PDF (4 cartelas por página)</h4>
            <div class="pdf-cards" id="pdf-preview"></div>
          </div>
          <div class="actions">
            <button class="btn btn-primary" onclick="generatePDF()">Gerar PDF para Impressão</button>
            <button class="btn btn-secondary" onclick="showScreen('generate-screen')">Voltar</button>
          </div>
        </div>
      </div>

      <!-- Tela de Configuração do Sorteio -->
      <div id="config-screen" class="screen">
        <h2>Configuração do Sorteio</h2>
        <p>Escolha as opções para o jogo de bingo.</p>

        <div class="form-group">
          <label>Operações Matemáticas:</label>
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="operation-add" checked>
              <label for="operation-add">Adição (+)</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="operation-subtract" checked>
              <label for="operation-subtract">Subtração (-)</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="operation-multiply">
              <label for="operation-multiply">Multiplicação (×)</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="operation-divide">
              <label for="operation-divide">Divisão (÷)</label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="result-min">Resultado Mínimo (para cartelas e sorteio):</label>
          <input type="number" id="result-min" value="1" min="1">
        </div>

        <div class="form-group">
          <label for="result-max">Resultado Máximo (para cartelas e sorteio):</label>
          <input type="number" id="result-max" value="50" min="2">
        </div>

        <div class="difficulty-group">
          <div class="form-group">
            <label for="expression-difficulty">Dificuldade da Expressão:</label>
            <select id="expression-difficulty">
              <option value="easy">Fácil (2 números, 1 operação)</option>
              <option value="medium">Média (3-5 números, até 3 operações)</option>
              <option value="hard">Difícil (5-10 números, todas as operações, parênteses)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="calculation-difficulty">Dificuldade das Contas (números usados nas expressões):</label>
            <select id="calculation-difficulty">
              <option value="easy">Fácil (1-100)</option>
              <option value="medium" selected>Média (1-200)</option>
              <option value="hard">Difícil (1-500)</option>
            </select>
          </div>
        </div>

        <div class="info-text">
          <strong>Nota:</strong>
          <ul>
            <li>O intervalo de resultados define os números que aparecerão nas cartelas e que poderão ser resultados das expressões.</li>
            <li>A dificuldade das contas define o intervalo dos números usados nas expressões.</li>
          </ul>
        </div>

        <div class="actions">
          <button class="btn btn-primary" onclick="startGame()">Iniciar Jogo</button>
          <button class="btn btn-secondary" onclick="showScreen('home-screen')">Voltar</button>
        </div>
      </div>

      <!-- Tela de Jogo -->
      <div id="game-screen" class="screen">
        <h2>Bingo em Andamento!</h2>
        <div class="game-layout">
          <div class="game-main">
            <div class="operation-display" id="current-expression">5 + 3</div>
            <div class="number-display" id="current-number">?</div>
            <div class="actions">
              <button class="btn btn-primary" onclick="drawExpression()">Sortear Expressão</button>
              <button class="btn btn-tertiary" onclick="showScreen('config-screen')">Voltar</button>
            </div>
            <div class="verifier">
              <h3>Verificador de Cartela</h3>
              <p>Digite um número para verificar se foi sorteado:</p>
              <div class="verifier-input">
                <input type="number" id="verify-number" placeholder="Número">
                <button class="btn btn-secondary" onclick="verifyNumber()">Verificar</button>
              </div>
              <div id="verify-result" class="verifier-result"></div>
            </div>
          </div>
          <div class="game-sidebar">
            <h3 class="history-title">Expressões Sorteadas:</h3>
            <div class="drawn-expressions" id="drawn-expressions"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer><p>Bingo Matemático &copy; 2025 - Ferramenta educacional para professores</p></footer>

  <script>
    // Variáveis globais
    let drawnExpressions = [];
    let drawnResults = new Set();
    let availableOperations = [];
    let resultMin = 1;
    let resultMax = 50;
    let generatedCards = [];

    // Navegação
    function showScreen(id){
      document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // ======= Geração de Cartelas =======
    function hasEnoughUnique(min,max){
      return (max - min + 1) >= 24; // 24 números + 1 FREE = 25 células
    }

    function generateCards(){
      const min = parseInt(document.getElementById('min-number').value);
      const max = parseInt(document.getElementById('max-number').value);
      const count = parseInt(document.getElementById('card-count').value);

      if (min >= max){
        alert('O número mínimo deve ser menor que o número máximo.');
        return;
      }
      if (!hasEnoughUnique(min,max)){
        alert('Para uma cartela 5×5 com espaço FREE, é necessário um intervalo com pelo menos 24 números distintos.\nAjuste o intervalo para prosseguir.');
        return;
      }
      if (count < 1){
        alert('A quantidade de cartelas deve ser pelo menos 1.');
        return;
      }

      generatedCards = [];
      for (let i=0;i<count;i++){
        generatedCards.push(generateBingoCard(min,max));
      }
      showPDFPreview();
      document.getElementById('generated-cards').style.display = 'block';
    }

    function generateBingoCard(min,max){
      // Gera 24 números únicos no intervalo [min,max]
      const needed = 24;
      const pool = max - min + 1;
      if (pool < needed){
        // Segurança extra: nunca tentar gerar com pool insuficiente
        throw new Error('Intervalo insuficiente para gerar cartela.');
      }
      let numbers = new Set();
      while (numbers.size < needed){
        numbers.add(getRandomNumber(min,max));
      }
      const arr = Array.from(numbers);
      // Embaralhar (Fisher-Yates)
      for (let i = arr.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      // Inserir FREE no centro
      arr.splice(12,0,'FREE');
      return arr;
    }

    function showPDFPreview(){
      const preview = document.getElementById('pdf-preview');
      preview.innerHTML = '';
      const previewCount = Math.min(4, generatedCards.length);
      for (let i=0;i<previewCount;i++){
        const card = generatedCards[i];
        const cardEl = document.createElement('div');
        cardEl.className = 'pdf-card';
        cardEl.innerHTML = `<h4>Cartela ${i+1}</h4>`;
        const grid = document.createElement('div');
        grid.className = 'pdf-card-grid';
        for (let j=0;j<25;j++){
          const cell = document.createElement('div');
          cell.className = 'pdf-cell';
          const val = card[j];
          if (val === 'FREE'){ cell.classList.add('free'); }
          cell.textContent = val;
          grid.appendChild(cell);
        }
        cardEl.appendChild(grid);
        preview.appendChild(cardEl);
      }
      if (generatedCards.length > 4){
        const more = document.createElement('p');
        more.style.textAlign = 'center';
        more.style.marginTop = '10px';
        more.textContent = `... e mais ${generatedCards.length - 4} cartelas`;
        preview.appendChild(more);
      }
    }

    function generatePDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const pageWidth = doc.internal.pageSize.getWidth();
      const margin = 10;
      const cardWidth = (pageWidth - 3 * margin) / 2;
      const cardHeight = cardWidth;

      let x = margin, y = margin;
      for (let i=0;i<generatedCards.length;i++){
        if (i>0 && i%4===0){
          doc.addPage();
          x = margin; y = margin;
        }
        drawBingoCardPDF(doc, generatedCards[i], x, y, cardWidth, cardHeight, i+1);
      }
      doc.save('cartelas-bingo.pdf');
    }

    function drawBingoCardPDF(doc, card, x, y, width, height, cardNumber){
      const cw = width/5, ch = height/5;
      doc.rect(x,y,width,height);
      for (let r=0;r<5;r++){
        for (let c=0;c<5;c++){
          const cellX = x + c*cw, cellY = y + r*ch;
          doc.rect(cellX, cellY, cw, ch);
          const val = String(card[r*5+c]);
          const textX = cellX + cw/2, textY = cellY + ch/2;
          if (val === 'FREE'){
            doc.setFillColor(74,144,226);
            doc.rect(cellX, cellY, cw, ch, 'F');
            doc.setTextColor(255,255,255);
          }
          doc.text(val, textX, textY, {align:'center', baseline:'middle'});
          doc.setTextColor(0,0,0);
        }
      }
      doc.setFontSize(10);
      doc.text(`Cartela ${cardNumber}`, x + width/2, y + height + 5, {align:'center', baseline:'top'});
    }

    // ======= Jogo =======
    function startGame(){
      availableOperations = [];
      if (document.getElementById('operation-add').checked) availableOperations.push('+');
      if (document.getElementById('operation-subtract').checked) availableOperations.push('-');
      if (document.getElementById('operation-multiply').checked) availableOperations.push('×');
      if (document.getElementById('operation-divide').checked) availableOperations.push('÷');

      if (availableOperations.length === 0){
        alert('Selecione pelo menos uma operação matemática.');
        return;
      }

      resultMin = parseInt(document.getElementById('result-min').value);
      resultMax = parseInt(document.getElementById('result-max').value);
      if (resultMin >= resultMax){
        alert('O resultado mínimo deve ser menor que o resultado máximo.');
        return;
      }

      showScreen('game-screen');
      drawnExpressions = [];
      drawnResults.clear();
      document.getElementById('drawn-expressions').innerHTML = '';
      document.getElementById('current-expression').textContent = '';
      document.getElementById('current-number').textContent = '?';
      document.getElementById('verify-result').textContent = '';
      document.getElementById('verify-number').value = '';
    }

    function drawExpression(){
      const exprDifficulty = document.getElementById('expression-difficulty').value;
      const calcDifficulty = document.getElementById('calculation-difficulty').value;
      const expression = generateExpression(availableOperations, exprDifficulty, calcDifficulty);
      drawnExpressions.push(expression);
      drawnResults.add(expression.result);
      document.getElementById('current-expression').textContent = expression.text;
      document.getElementById('current-number').textContent = '?';
      const el = document.createElement('div');
      el.className = 'drawn-expression';
      el.textContent = expression.text;
      document.getElementById('drawn-expressions').appendChild(el);
      const box = document.getElementById('drawn-expressions');
      box.scrollTop = box.scrollHeight;
    }

    function generateExpression(ops, exprDifficulty, calcDifficulty){
      let numberRange;
      switch(calcDifficulty){
        case 'easy': numberRange={min:1,max:100}; break;
        case 'medium': numberRange={min:1,max:200}; break;
        case 'hard': numberRange={min:1,max:500}; break;
        default: numberRange={min:1,max:100};
      }
      let text = '', result = 0, attempts = 0, maxAttempts = 50;

      const safeAltOp = (opsArr, avoid) => {
        const alt = opsArr.find(o=>o!==avoid);
        return alt || '+'; // fallback seguro
      };

      do{
        attempts++;
        if (exprDifficulty === 'easy'){
          const n1 = getRandomNumber(numberRange.min, numberRange.max);
          const n2 = getRandomNumber(numberRange.min, numberRange.max);
          let op = ops[Math.floor(Math.random()*ops.length)];
          if (op === '-'){
            text = `${Math.max(n1,n2)} - ${Math.min(n1,n2)}`;
            result = Math.max(n1,n2) - Math.min(n1,n2);
          } else if (op === '÷'){
            const divisors = getDivisors(n1);
            if (divisors.length){
              const d = divisors[Math.floor(Math.random()*divisors.length)];
              text = `${n1} ÷ ${d}`; result = n1 / d;
            } else {
              op = safeAltOp(ops, '÷');
              text = `${n1} ${op} ${n2}`; result = applyOperation(n1,n2,op);
            }
          } else {
            text = `${n1} ${op} ${n2}`; result = applyOperation(n1,n2,op);
          }
        } else {
          const numCount = (exprDifficulty==='medium') ? (Math.floor(Math.random()*3)+3) : (Math.floor(Math.random()*6)+5);
          const numbers = Array.from({length:numCount}, ()=>getRandomNumber(numberRange.min, numberRange.max));
          const useOps = Array.from({length:numCount-1}, ()=>ops[Math.floor(Math.random()*ops.length)]);
          text = String(numbers[0]); result = numbers[0];

          for (let i=1;i<numCount;i++){
            let op = useOps[i-1];
            const nextNum = numbers[i];
            if (op === '-' && nextNum > result){
              text = `${nextNum} - (${text})`; result = nextNum - result;
            } else if (op === '÷'){
              const divisors = getDivisors(result);
              if (divisors.length){
                const d = divisors[Math.floor(Math.random()*divisors.length)];
                text += ` ÷ ${d}`; result = result / d;
              } else {
                op = safeAltOp(ops, '÷');
                text += ` ${op} ${nextNum}`; result = applyOperation(result,nextNum,op);
              }
            } else {
              text += ` ${op} ${nextNum}`; result = applyOperation(result,nextNum,op);
            }
          }
          if (exprDifficulty==='hard') text = addParentheses(text);
        }
        result = Math.round(result);
      } while ((result < resultMin || result > resultMax) && attempts < maxAttempts);

      if (result < resultMin || result > resultMax){
        // Força uma expressão simples com resultado dentro do intervalo
        result = getRandomNumber(resultMin, resultMax);
        const n2 = getRandomNumber(1, 10);
        let op = ops[Math.floor(Math.random()*ops.length)];
        if (op === '+'){ text = `${result - n2} + ${n2}`; }
        else if (op === '-'){ text = `${result + n2} - ${n2}`; }
        else if (op === '×'){
          const divs = getDivisors(result);
          if (divs.length){ const d = divs[Math.floor(Math.random()*divs.length)]; text = `${d} × ${result/d}`; }
          else { text = `${result} × 1`; }
        } else if (op === '÷'){ text = `${result * n2} ÷ ${n2}`; }
      }
      return { text: text + ' = ?', result };
    }

    function addParentheses(expr){
      const parts = expr.split(' ');
      if (parts.length <= 3) return expr;
      const openPos = Math.floor(Math.random() * (parts.length - 3)) + 1;
      const closePos = Math.min(openPos + 4, parts.length - 1);
      parts.splice(openPos, 0, '(');
      parts.splice(closePos + 1, 0, ')');
      return parts.join(' ');
    }

    function getRandomNumber(min,max){
      return Math.floor(Math.random()*(max-min+1))+min;
    }
    function applyOperation(a,b,op){
      switch(op){case '+': return a+b; case '-': return a-b; case '×': return a*b; case '÷': return a/b; default: return a;}
    }
    function getDivisors(n){
      const out = [];
      // divisores positivos >1 que dividem n exatamente
      for (let i=2;i<=Math.abs(n);i++){ if (n % i === 0) out.push(i); }
      return out;
    }

    function verifyNumber(){
      const input = document.getElementById('verify-number');
      const resultDiv = document.getElementById('verify-result');
      if (!input.value){
        resultDiv.textContent = 'Por favor, digite um número para verificar.';
        resultDiv.className = 'verifier-result invalid';
        return;
      }
      const number = parseFloat(input.value);
      if (drawnResults.has(number)){
        const expression = drawnExpressions.find(e => e.result === number);
        resultDiv.innerHTML = `✓ Este número foi sorteado!<br>Expressão: ${expression.text.replace('?', number)}`;
        resultDiv.className = 'verifier-result valid';
      } else {
        resultDiv.textContent = '✗ Este número NÃO foi sorteado.';
        resultDiv.className = 'verifier-result invalid';
      }
    }

    // ======= Pré-visualização e validação dinâmica =======
    function updateCardPreview(){
      const min = parseInt(document.getElementById('min-number').value) || 1;
      const max = parseInt(document.getElementById('max-number').value) || 50;
      const warn = document.getElementById('range-warn');
      const ok = document.getElementById('range-ok');
      const btn = document.getElementById('btn-generate');

      warn.style.display = 'none';
      ok.style.display = 'none';

      if (min >= max){
        btn.disabled = true;
        warn.textContent = 'O mínimo deve ser menor que o máximo.';
        warn.style.display = 'block';
        return;
      }
      if (!hasEnoughUnique(min,max)){
        btn.disabled = true;
        const falta = 24 - (max - min + 1);
        warn.innerHTML = `Intervalo insuficiente para preencher a cartela sem repetir: faltam ${falta} número(s).<br>
                          Use um intervalo com pelo menos <strong>24</strong> números distintos (ex.: 1 a 24).`;
        warn.style.display = 'block';
        return;
      }

      btn.disabled = false;
      ok.textContent = 'Intervalo válido para gerar cartelas.';
      ok.style.display = 'block';

      // Gera prévia segura
      const card = generateBingoCard(min, max);
      const cells = document.querySelectorAll('.card-preview .card-cell');
      for (let i=0;i<cells.length;i++){
        const val = card[i];
        cells[i].textContent = val;
        if (val === 'FREE'){ cells[i].classList.add('free'); } else { cells[i].classList.remove('free'); }
      }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('min-number').addEventListener('input', updateCardPreview);
      document.getElementById('max-number').addEventListener('input', updateCardPreview);
      updateCardPreview();
    });
  </script>
</body>
</html>
