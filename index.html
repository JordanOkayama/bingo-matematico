<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Bingo Matemático</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root{
      --bg: #0b0f14;
      --glass: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.12);
      --text: #e7ecf2;
      --muted: #a8b3c5;
      --primary: #8a63ff;
      --accent: #19d3da;
      --danger: #ff5d6c;
      --success:#2ed573;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    body{margin:0;background:#0b0f14;color:var(--text);font-family:"Inter",sans-serif}
    .wrap{max-width:1200px;margin:32px auto;padding:0 16px}
    .glass{background:var(--glass);border:1px solid var(--stroke);backdrop-filter: blur(14px) saturate(130%);border-radius:18px;box-shadow: var(--shadow);}
    header.hero{padding:28px 24px;display:flex;align-items:center;justify-content:space-between;gap:16px;}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:42px;height:42px;border-radius:12px;background: conic-gradient(from 120deg, #7c4dff, #19d3da, #7c4dff);}
    .brand h1{margin:0;font-size:1.35rem}
    .hero-actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{padding:12px 18px;border:none;border-radius:12px;cursor:pointer;font-weight:700;color:#0c0f14;background: linear-gradient(135deg, #8a63ff, #19d3da);box-shadow: 0 8px 24px rgba(138,99,255,.35);transition: .2s}
    .btn:hover{transform: translateY(-2px)}
    .btn.success{background: linear-gradient(135deg, #2ed573, #19d3da)}
    .btn.danger{background: linear-gradient(135deg, #ff6b81, #ff9a9e)}
    .section{margin-top:22px;padding:22px}
    .section h2{margin:0 0 6px 0;font-size:1.2rem}
    .screen{display:none}
    .screen.active{display:block}
    .expression{font-size:1.6rem;font-weight:800;margin:10px 0 14px 0;color:#f4f6ff;text-shadow:0 2px 18px rgba(138,99,255,.25)}
    .history{max-height:260px;overflow:auto;padding:12px;border-radius:14px;border:1px solid var(--stroke);background:rgba(255,255,255,.05)}
    .history .item{padding:8px 10px;border-bottom:1px dashed var(--stroke);font-weight:600}
    .history .item:last-child{border-bottom:none}
    .cards-wrap{display:grid;grid-template-columns:repeat(auto-fit, minmax(260px,1fr));gap:14px;margin-top:12px}
    .card{padding:12px;border-radius:14px;border:2px solid var(--accent);background:linear-gradient(160deg, rgba(138,99,255,0.15), rgba(25,211,218,0.15));box-shadow:0 6px 16px rgba(0,0,0,0.4)}
    .ticket-grid{display:grid;gap:6px}
    .ticket-grid[data-size="3"]{grid-template-columns:repeat(3,1fr)}
    .ticket-grid[data-size="5"]{grid-template-columns:repeat(5,1fr)}
    .ticket-grid[data-size="7"]{grid-template-columns:repeat(7,1fr)}
    .cell{border:1px solid var(--stroke);border-radius:8px;padding:14px;text-align:center;font-weight:800;font-size:1.2rem;background:rgba(255,255,255,0.07)}
    .cell:nth-child(even){background:rgba(255,255,255,0.12)}
    .alert{padding:10px 12px;border-radius:12px;margin:10px 0;font-weight:600}
    .alert.success{background:rgba(46,213,115,.08);border:1px solid rgba(46,213,115,.35);color:#9bffc2}
    .alert.danger{background:rgba(255,109,120,.08);border:1px solid rgba(255,109,120,.4);color:#ffc2c7}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero glass">
      <div class="brand"><div class="logo"></div><h1>Bingo Matemático</h1></div>
      <div class="hero-actions">
        <button class="btn" data-target="generate">Gerar cartela</button>
        <button class="btn success" data-target="config">Começar sorteio</button>
        <button class="btn danger" data-target="home">Início</button>
      </div>
    </header>

    <section id="home" class="screen active section glass">
      <h2>Bem-vindo!</h2>
      <p>Gere cartelas ou configure o sorteio.</p>
    </section>

    <section id="generate" class="screen section glass">
      <h2>Gerador de cartelas</h2>
      <label>Intervalo mínimo</label><input id="min-number" type="number" value="1"/>
      <label>Intervalo máximo</label><input id="max-number" type="number" value="60"/>
      <label>Tamanho</label>
      <select id="grid-size"><option value="3">3×3</option><option value="5" selected>5×5</option><option value="7">7×7</option></select>
      <label>Quantidade</label><input id="card-count" type="number" value="4"/>
      <button class="btn" id="btn-generate">Gerar</button>
      <button class="btn success" id="btn-pdf">Exportar PDF</button>
      <div id="cards-preview" class="cards-wrap"></div>
    </section>

    <section id="config" class="screen section glass">
      <h2>Configurações do sorteio</h2>
      <label>Dificuldade</label>
      <select id="difficulty"><option value="easy">Fácil</option><option value="normal">Normal</option><option value="hard">Difícil</option></select>
      <label>Operações</label>
      <input type="checkbox" id="op-add" checked> + 
      <input type="checkbox" id="op-sub" checked> − 
      <input type="checkbox" id="op-mul" checked> × 
      <input type="checkbox" id="op-div"> ÷ 
      <label>Intervalo de resultado</label>
      <input id="draw-min" type="number" value="1"> a <input id="draw-max" type="number" value="100">
      <button class="btn success" onclick="startGame()">Iniciar</button>
    </section>

    <section id="draw" class="screen section glass">
      <h2>Sorteio</h2>
      <div class="expression" id="current-expression">Pronto…</div>
      <button class="btn" onclick="drawExpression()">Sortear expressão</button>
      <button class="btn danger" onclick="clearDraws()">Limpar sorteio</button>
      <h3>Histórico</h3>
      <div id="history" class="history"></div>
      <h3>Verificação</h3>
      <input type="number" id="check-number"><button class="btn success" onclick="checkNumber()">Verificar</button>
      <div id="check-result" class="alert" style="display:none"></div>
    </section>
  </div>

  <script>
    let generatedCards=[],cardSize=5,expressionsSet=new Set(),resultsMap=new Map();

    document.querySelectorAll("[data-target]").forEach(b=>b.onclick=()=>showScreen(b.dataset.target));
    function showScreen(id){document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));document.getElementById(id).classList.add("active");}

    document.getElementById("btn-generate").onclick=()=>{
      const min=+document.getElementById("min-number").value,max=+document.getElementById("max-number").value,count=+document.getElementById("card-count").value;
      cardSize=+document.getElementById("grid-size").value;
      generatedCards=[];for(let i=0;i<count;i++){generatedCards.push(generateCard(min,max,cardSize));}
      renderCards();
    }
    function generateCard(min,max,size){const pool=[];for(let i=min;i<=max;i++)pool.push(i);for(let i=pool.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[pool[i],pool[j]]=[pool[j],pool[i]];}return pool.slice(0,size*size);}
    function renderCards(){const c=document.getElementById("cards-preview");c.innerHTML="";generatedCards.forEach(nums=>{const card=document.createElement("div");card.className="card";const grid=document.createElement("div");grid.className="ticket-grid";grid.dataset.size=cardSize;nums.forEach(n=>{const cell=document.createElement("div");cell.className="cell";cell.textContent=n;grid.appendChild(cell)});card.appendChild(grid);c.appendChild(card);});}

    // PDF export com cabeçalho estilizado
    document.getElementById("btn-pdf").onclick=()=>{
      if(!generatedCards.length)return;
      const {jsPDF}=window.jspdf;
      const doc=new jsPDF({orientation:"landscape",unit:"pt",format:"a4"});
      const pageW=doc.internal.pageSize.getWidth(),pageH=doc.internal.pageSize.getHeight();
      const perPage=4;
      generatedCards.forEach((nums,idx)=>{
        if(idx%perPage===0 && idx!==0)doc.addPage();
        const pos=idx%perPage;
        const offsetX=(pos%2)*(pageW/2);
        const offsetY=Math.floor(pos/2)*(pageH/2);
        const size=cardSize,cell=Math.min((pageW/2-80)/size,(pageH/2-120)/size);
        
        // Cabeçalho
        doc.setFont("helvetica","bold");doc.setFontSize(20);
        doc.setTextColor(138,99,255);
        doc.text("Bingo Matemático",offsetX+40,offsetY+30);
        doc.setFontSize(14);
        doc.setTextColor(25,211,218);
        doc.text(`Cartela ${idx+1}`,offsetX+40,offsetY+50);
        doc.setTextColor(0,0,0);

        // Grid
        doc.setFont("helvetica","bold");doc.setFontSize(16);
        for(let r=0;r<size;r++){
          for(let c=0;c<size;c++){
            const n=nums[r*size+c];
            doc.rect(offsetX+40+c*cell,offsetY+70+r*cell,cell,cell);
            doc.text(String(n),offsetX+40+c*cell+cell/2,offsetY+70+r*cell+cell/2,{align:"center",baseline:"middle"});
          }
        }
      });
      doc.save("cartelas.pdf");
    };

    function startGame(){expressionsSet.clear();resultsMap.clear();showScreen("draw");}
    function clearDraws(){expressionsSet.clear();resultsMap.clear();document.getElementById("history").innerHTML="";document.getElementById("current-expression").textContent="Pronto…";}
    function drawExpression(){let expr="",val;let tries=0;do{[expr,val]=genExpr();tries++;if(tries>100)return;}while(resultsMap.has(val));expressionsSet.add(expr);resultsMap.set(val,expr);document.getElementById("current-expression").textContent=expr;const i=document.createElement("div");i.className="item";i.textContent=`${expr} = (?)`;document.getElementById("history").prepend(i);}
    function genExpr(){const ops=[];if(op("op-add"))ops.push("+");if(op("op-sub"))ops.push("-");if(op("op-mul"))ops.push("*");if(op("op-div"))ops.push("/");if(!ops.length)ops.push("+");const n1=rand(1,50),n2=rand(1,50),opSel=ops[rand(0,ops.length-1)];const expr=`${n1} ${sym(opSel)} ${n2}`;const val=eval(`${n1}${opSel}${n2}`);return [expr,val];}
    function sym(op){return op==="*"? "×" : op==="/" ? "÷" : op;}
    function op(id){return document.getElementById(id).checked;}
    function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a;}

    function checkNumber(){const n=+document.getElementById("check-number").value,res=document.getElementById("check-result");if(isNaN(n)){res.className="alert danger";res.style.display="block";res.textContent="Número inválido.";return;}if(resultsMap.has(n)){res.className="alert success";res.style.display="block";res.textContent=`✔ O número ${n} foi sorteado (expressão: ${resultsMap.get(n)}).`;}else{res.className="alert danger";res.style.display="block";res.textContent=`✖ O número ${n} não foi sorteado.`;}}
  </script>
</body>
</html>
