<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Matemático</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin: 20px 0;
        }
        
        header {
            background: #4A90E2;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .screen {
            display: none;
        }
        
        .active {
            display: block;
        }
        
        .home-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            margin-top: 40px;
        }
        
        .btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            display: inline-block;
            text-align: center;
            text-decoration: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: #4A90E2;
            color: white;
        }
        
        .btn-primary:hover {
            background: #357ABD;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-secondary {
            background: #50C878;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #3DAF64;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-tertiary {
            background: #FF6B6B;
            color: white;
        }
        
        .btn-tertiary:hover {
            background: #E55C5C;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #444;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        input:focus, select:focus {
            border-color: #4A90E2;
            outline: none;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-preview {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin: 20px 0;
            max-width: 300px;
        }
        
        .card-cell {
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-cell.free {
            background: #4A90E2;
            color: white;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .cartelas-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .cartela {
            border: 2px solid #4A90E2;
            border-radius: 10px;
            padding: 15px;
            background: white;
        }
        
        .cartela h3 {
            text-align: center;
            margin-bottom: 10px;
            color: #4A90E2;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .number-display {
            font-size: 5rem;
            font-weight: bold;
            color: #4A90E2;
            background: #f0f0f0;
            border-radius: 15px;
            padding: 20px 40px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            text-align: center;
        }
        
        .operation-display {
            font-size: 2rem;
            color: #555;
            margin-bottom: 10px;
            min-height: 60px;
            text-align: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
        }
        
        .drawn-expressions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
            max-width: 600px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 2px solid #4A90E2;
            border-radius: 10px;
            width: 100%;
        }
        
        .drawn-expression {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        .verifier {
            margin-top: 20px;
            padding: 20px;
            border: 2px solid #4A90E2;
            border-radius: 10px;
            background: #f8f8f8;
            width: 100%;
            max-width: 500px;
        }
        
        .verifier-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .verifier-input input {
            flex: 1;
        }
        
        .verifier-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        .verifier-result.valid {
            background: #d4edda;
            color: #155724;
        }
        
        .verifier-result.invalid {
            background: #f8d7da;
            color: #721c24;
        }
        
        .difficulty-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .game-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            width: 100%;
        }
        
        .game-main {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .game-sidebar {
            display: flex;
            flex-direction: column;
        }
        
        @media (max-width: 968px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .difficulty-group {
                grid-template-columns: 1fr;
            }
            
            .cartelas-container {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 12px 30px;
                font-size: 1.1rem;
            }
            
            .number-display {
                font-size: 3.5rem;
                padding: 15px 30px;
            }
            
            .game-layout {
                grid-template-columns: 1fr;
            }
        }
        
        .history-title {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .info-text {
            background: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4A90E2;
        }
        
        .pdf-preview {
            margin: 20px 0;
            padding: 15px;
            border: 2px dashed #4A90E2;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .pdf-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .pdf-card {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            background: white;
        }
        
        .pdf-card h4 {
            text-align: center;
            margin-bottom: 5px;
            color: #4A90E2;
        }
        
        .pdf-card-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 3px;
        }
        
        .pdf-cell {
            border: 1px solid #ddd;
            border-radius: 3px;
            padding: 5px;
            text-align: center;
            font-size: 0.8rem;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pdf-cell.free {
            background: #4A90E2;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Bingo Matemático</h1>
            <p class="subtitle">Aprenda matemática de forma divertida!</p>
        </header>
        
        <div class="content">
            <!-- Tela Inicial -->
            <div id="home-screen" class="screen active">
                <h2>Bem-vindo ao Bingo Matemático</h2>
                <p>Escolha uma das opções abaixo para começar:</p>
                
                <div class="home-buttons">
                    <button class="btn btn-primary" onclick="showScreen('generate-screen')">Gerar Cartelas</button>
                    <button class="btn btn-secondary" onclick="showScreen('config-screen')">Começar</button>
                </div>
                
                <div style="margin-top: 40px; text-align: center;">
                    <h3>Como funciona?</h3>
                    <p>O Bingo Matemático ajuda os alunos a praticarem as quatro operações básicas de forma divertida.</p>
                    <p>Gere cartelas personalizadas ou inicie um jogo com suas configurações preferidas.</p>
                </div>
            </div>
            
            <!-- Tela de Geração de Cartelas -->
            <div id="generate-screen" class="screen">
                <h2>Gerar Cartelas</h2>
                <p>Preencha as informações abaixo para gerar as cartelas de bingo.</p>
                
                <div class="form-group">
                    <label for="min-number">Número Mínimo:</label>
                    <input type="number" id="min-number" value="1" min="1">
                </div>
                
                <div class="form-group">
                    <label for="max-number">Número Máximo:</label>
                    <input type="number" id="max-number" value="50" min="2">
                </div>
                
                <div class="form-group">
                    <label for="card-count">Quantidade de Cartelas:</label>
                    <input type="number" id="card-count" value="4" min="1" max="100">
                </div>
                
                <h3>Pré-visualização da Cartela:</h3>
                <div class="card-preview">
                    <div class="card-cell">17</div>
                    <div class="card-cell">5</div>
                    <div class="card-cell">32</div>
                    <div class="card-cell">12</div>
                    <div class="card-cell">28</div>
                    <div class="card-cell">8</div>
                    <div class="card-cell">19</div>
                    <div class="card-cell">41</div>
                    <div class="card-cell">3</div>
                    <div class="card-cell">45</div>
                    <div class="card-cell">22</div>
                    <div class="card-cell">14</div>
                    <div class="card-cell free">FREE</div>
                    <div class="card-cell">7</div>
                    <div class="card-cell">36</div>
                    <div class="card-cell">10</div>
                    <div class="card-cell">29</div>
                    <div class="card-cell">1</div>
                    <div class="card-cell">39</div>
                    <div class="card-cell">24</div>
                    <div class="card-cell">31</div>
                    <div class="card-cell">16</div>
                    <div class="card-cell">43</div>
                    <div class="card-cell">9</div>
                    <div class="card-cell">20</div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-primary" onclick="generateCards()">Gerar Cartelas</button>
                    <button class="btn btn-secondary" onclick="showScreen('home-screen')">Voltar</button>
                </div>
                
                <div id="generated-cards" style="display: none;">
                    <h3>Suas cartelas foram geradas!</h3>
                    <div class="pdf-preview">
                        <h4>Pré-visualização do PDF (4 cartelas por página)</h4>
                        <div class="pdf-cards" id="pdf-preview">
                            <!-- Pré-visualização das cartelas PDF -->
                        </div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-primary" onclick="generatePDF()">Gerar PDF para Impressão</button>
                        <button class="btn btn-secondary" onclick="showScreen('generate-screen')">Voltar</button>
                    </div>
                </div>
            </div>
            
            <!-- Tela de Configuração do Sorteio -->
            <div id="config-screen" class="screen">
                <h2>Configuração do Sorteio</h2>
                <p>Escolha as opções para o jogo de bingo.</p>
                
                <div class="form-group">
                    <label>Operações Matemáticas:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="operation-add" checked>
                            <label for="operation-add">Adição (+)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="operation-subtract" checked>
                            <label for="operation-subtract">Subtração (-)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="operation-multiply">
                            <label for="operation-multiply">Multiplicação (×)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="operation-divide">
                            <label for="operation-divide">Divisão (÷)</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="result-min">Resultado Mínimo (para cartelas e sorteio):</label>
                    <input type="number" id="result-min" value="1" min="1">
                </div>
                
                <div class="form-group">
                    <label for="result-max">Resultado Máximo (para cartelas e sorteio):</label>
                    <input type="number" id="result-max" value="50" min="2">
                </div>
                
                <div class="difficulty-group">
                    <div class="form-group">
                        <label for="expression-difficulty">Dificuldade da Expressão:</label>
                        <select id="expression-difficulty">
                            <option value="easy">Fácil (2 números, 1 operação)</option>
                            <option value="medium">Média (3-5 números, até 3 operações)</option>
                            <option value="hard">Difícil (5-10 números, todas as operações, parênteses)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="calculation-difficulty">Dificuldade das Contas (números usados nas expressões):</label>
                        <select id="calculation-difficulty">
                            <option value="easy">Fácil (1-100)</option>
                            <option value="medium" selected>Média (1-200)</option>
                            <option value="hard">Difícil (1-500)</option>
                        </select>
                    </div>
                </div>
                
                <div class="info-text">
                    <strong>Nota:</strong> 
                    <ul>
                        <li>O intervalo de resultados defines os números que aparecerão nas cartelas e que poderão ser resultados das expressões</li>
                        <li>A dificuldade das contas define o intervalo dos números usados nas expressões</li>
                    </ul>
                </div>
                
                <div class="actions">
                    <button class="btn btn-primary" onclick="startGame()">Iniciar Jogo</button>
                    <button class="btn btn-secondary" onclick="showScreen('home-screen')">Voltar</button>
                </div>
            </div>
            
            <!-- Tela de Jogo -->
            <div id="game-screen" class="screen">
                <h2>Bingo em Andamento!</h2>
                
                <div class="game-layout">
                    <div class="game-main">
                        <div class="operation-display" id="current-expression">5 + 3</div>
                        <div class="number-display" id="current-number">?</div>
                        
                        <div class="actions">
                            <button class="btn btn-primary" onclick="drawExpression()">Sortear Expressão</button>
                            <button class="btn btn-tertiary" onclick="showScreen('config-screen')">Voltar</button>
                        </div>
                        
                        <div class="verifier">
                            <h3>Verificador de Cartela</h3>
                            <p>Digite um número para verificar se foi sorteado:</p>
                            <div class="verifier-input">
                                <input type="number" id="verify-number" placeholder="Número">
                                <button class="btn btn-secondary" onclick="verifyNumber()">Verificar</button>
                            </div>
                            <div id="verify-result" class="verifier-result"></div>
                        </div>
                    </div>
                    
                    <div class="game-sidebar">
                        <h3 class="history-title">Expressões Sorteadas:</h3>
                        <div class="drawn-expressions" id="drawn-expressions">
                            <!-- Expressões sorteadas aparecerão aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Bingo Matemático &copy; 2023 - Ferramenta educacional para professores</p>
    </footer>

    <script>
        // Variáveis globais
        let drawnExpressions = [];
        let drawnResults = new Set();
        let availableOperations = [];
        let resultMin = 1;
        let resultMax = 50;
        let generatedCards = [];
        
        // Funções para navegação entre telas
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        // Função para gerar cartelas - CORRIGIDA
        function generateCards() {
            const min = parseInt(document.getElementById('min-number').value);
            const max = parseInt(document.getElementById('max-number').value);
            const count = parseInt(document.getElementById('card-count').value);
            const errorMessage = document.getElementById('error-message');
            
            // Validação básica
            if (min >= max) {
                errorMessage.textContent = 'O número mínimo deve ser menor que o número máximo.';
                errorMessage.style.display = 'block';
                return;
            }
            
            if (count < 1) {
                errorMessage.textContent = 'A quantidade de cartelas deve ser pelo menos 1.';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Verificar se o intervalo é suficiente para gerar números únicos
            const rangeSize = max - min + 1;
            if (rangeSize < 24) {
                errorMessage.style.display = 'block';
                return;
            } else {
                errorMessage.style.display = 'none';
            }
            
            // Gerar cartelas
            generatedCards = [];
            for (let i = 0; i < count; i++) {
                generatedCards.push(generateBingoCard(min, max));
            }
            
            // Mostrar pré-visualização do PDF
            showPDFPreview();
            
            document.getElementById('generated-cards').style.display = 'block';
        }
        
        // Função para gerar uma cartela de bingo - CORRIGIDA
        function generateBingoCard(min, max) {
            // Gerar 24 números únicos dentro do intervalo
            let numbers = new Set();
            const rangeSize = max - min + 1;
            
            // Se o intervalo for grande o suficiente, gerar números únicos
            if (rangeSize >= 24) {
                while (numbers.size < 24) {
                    numbers.add(Math.floor(Math.random() * rangeSize) + min);
                }
            } else {
                // Se o intervalo for pequeno, permitir números repetidos
                // (não ideal para bingo, mas evita o travamento)
                for (let i = 0; i < 24; i++) {
                    numbers.add(Math.floor(Math.random() * rangeSize) + min);
                }
            }
            
            numbers = Array.from(numbers);
            
            // Embaralhar
            for (let i = numbers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
            }
            
            // Inserir FREE no meio (posição 12)
            numbers.splice(12, 0, 'FREE');
            
            return numbers;
        }
        
        // Atualizar a pré-visualização da cartela - CORRIGIDA
        function updateCardPreview() {
            const min = parseInt(document.getElementById('min-number').value) || 1;
            const max = parseInt(document.getElementById('max-number').value) || 50;
            const errorMessage = document.getElementById('error-message');
            
            if (min >= max) {
                errorMessage.textContent = 'O número mínimo deve ser menor que o número máximo.';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Verificar se o intervalo é suficiente
            const rangeSize = max - min + 1;
            if (rangeSize < 24) {
                errorMessage.style.display = 'block';
                return;
            } else {
                errorMessage.style.display = 'none';
            }
        
        function showPDFPreview() {
            const previewContainer = document.getElementById('pdf-preview');
            previewContainer.innerHTML = '';
            
            // Mostrar apenas as primeiras 4 cartelas para pré-visualização
            const previewCount = Math.min(4, generatedCards.length);
            
            for (let i = 0; i < previewCount; i++) {
                const card = generatedCards[i];
                const cardElement = document.createElement('div');
                cardElement.className = 'pdf-card';
                cardElement.innerHTML = `<h4>Cartela ${i + 1}</h4>`;
                
                const grid = document.createElement('div');
                grid.className = 'pdf-card-grid';
                
                for (let j = 0; j < 25; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'pdf-cell';
                    if (j === 12) {
                        cell.className += ' free';
                        cell.textContent = 'FREE';
                    } else {
                        const valueIndex = j > 12 ? j - 1 : j;
                        cell.textContent = card[valueIndex];
                    }
                    grid.appendChild(cell);
                }
                
                cardElement.appendChild(grid);
                previewContainer.appendChild(cardElement);
            }
            
            if (generatedCards.length > 4) {
                const moreCards = document.createElement('p');
                moreCards.style.textAlign = 'center';
                moreCards.style.marginTop = '10px';
                moreCards.textContent = `... e mais ${generatedCards.length - 4} cartelas`;
                previewContainer.appendChild(moreCards);
            }
        }
        
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const min = parseInt(document.getElementById('min-number').value);
            const max = parseInt(document.getElementById('max-number').value);
            
            // Configurações do PDF
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 10;
            const cardWidth = (pageWidth - 3 * margin) / 2;
            const cardHeight = cardWidth; // Cartela quadrada
            
            let currentPage = 1;
            let x = margin;
            let y = margin;
            
            for (let i = 0; i < generatedCards.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    doc.addPage();
                    currentPage++;
                    x = margin;
                    y = margin;
                }
                
                drawBingoCardPDF(doc, generatedCards[i], x, y, cardWidth, cardHeight, i + 1);
                
                // Avançar para a próxima posição
                if (i % 2 === 0) {
                    x += cardWidth + margin;
                } else {
                    x = margin;
                    y += cardHeight + margin;
                }
            }
            
            // Salvar o PDF
            doc.save('cartelas-bingo.pdf');
        }
        
        function drawBingoCardPDF(doc, card, x, y, width, height, cardNumber) {
            const cellWidth = width / 5;
            const cellHeight = height / 5;
            
            // Desenhar borda da cartela
            doc.rect(x, y, width, height);
            
            // Desenhar células
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const cellX = x + col * cellWidth;
                    const cellY = y + row * cellHeight;
                    doc.rect(cellX, cellY, cellWidth, cellHeight);
                    
                    const index = row * 5 + col;
                    let text = card[index].toString();
                    
                    // Centralizar texto na célula
                    const textX = cellX + cellWidth / 2;
                    const textY = cellY + cellHeight / 2;
                    
                    if (text === 'FREE') {
                        doc.setFillColor(74, 144, 226);
                        doc.rect(cellX, cellY, cellWidth, cellHeight, 'F');
                        doc.setTextColor(255, 255, 255);
                    }
                    
                    doc.text(text, textX, textY, { align: 'center', baseline: 'middle' });
                    
                    // Resetar cor do texto
                    doc.setTextColor(0, 0, 0);
                }
            }
            
            // Adicionar número da cartela
            doc.setFontSize(10);
            doc.text(`Cartela ${cardNumber}`, x + width / 2, y + height + 5, { align: 'center', baseline: 'top' });
        }
        
        // Funções para o jogo
        function startGame() {
            // Validar se pelo menos uma operação foi selecionada
            availableOperations = [];
            if (document.getElementById('operation-add').checked) availableOperations.push('+');
            if (document.getElementById('operation-subtract').checked) availableOperations.push('-');
            if (document.getElementById('operation-multiply').checked) availableOperations.push('×');
            if (document.getElementById('operation-divide').checked) availableOperations.push('÷');
            
            if (availableOperations.length === 0) {
                alert('Selecione pelo menos uma operação matemática.');
                return;
            }
            
            // Obter os valores mínimo e máximo definidos pelo usuário para resultados
            resultMin = parseInt(document.getElementById('result-min').value);
            resultMax = parseInt(document.getElementById('result-max').value);
            
            // Validar intervalo
            if (resultMin >= resultMax) {
                alert('O resultado mínimo deve ser menor que o resultado máximo.');
                return;
            }
            
            // Iniciar o jogo
            showScreen('game-screen');
            
            // Limpar expressões sorteadas anteriores
            drawnExpressions = [];
            drawnResults.clear();
            document.getElementById('drawn-expressions').innerHTML = '';
            document.getElementById('current-expression').textContent = '';
            document.getElementById('current-number').textContent = '?';
            document.getElementById('verify-result').textContent = '';
            document.getElementById('verify-number').value = '';
        }
        
        function drawExpression() {
            // Obter configurações
            const expressionDifficulty = document.getElementById('expression-difficulty').value;
            const calculationDifficulty = document.getElementById('calculation-difficulty').value;
            
            // Gerar expressão com base nas dificuldades
            const expression = generateExpression(availableOperations, expressionDifficulty, calculationDifficulty);
            
            // Adicionar às expressões sorteadas
            drawnExpressions.push(expression);
            drawnResults.add(expression.result);
            
            // Atualizar a exibição
            document.getElementById('current-expression').textContent = expression.text;
            document.getElementById('current-number').textContent = '?';
            
            // Adicionar a expressão à lista de expressões sorteadas
            const exprElement = document.createElement('div');
            exprElement.classList.add('drawn-expression');
            exprElement.textContent = expression.text;
            document.getElementById('drawn-expressions').appendChild(exprElement);
            
            // Rolagem automática para a última expressão
            document.getElementById('drawn-expressions').scrollTop = document.getElementById('drawn-expressions').scrollHeight;
        }
        
        function generateExpression(operations, exprDifficulty, calcDifficulty) {
            // Determinar a faixa de números com base na dificuldade dos cálculos (números usados nas expressões)
            let numberRange;
            switch(calcDifficulty) {
                case 'easy': numberRange = {min: 1, max: 100}; break;
                case 'medium': numberRange = {min: 1, max: 200}; break;
                case 'hard': numberRange = {min: 1, max: 500}; break;
                default: numberRange = {min: 1, max: 100};
            }
            
            let expressionText = '';
            let result = 0;
            let attempts = 0;
            const maxAttempts = 50; // Para evitar loops infinitos
            
            do {
                attempts++;
                if (exprDifficulty === 'easy') {
                    // Modo fácil: dois números e uma operação
                    const num1 = getRandomNumber(numberRange.min, numberRange.max);
                    const num2 = getRandomNumber(numberRange.min, numberRange.max);
                    const op = operations[Math.floor(Math.random() * operations.length)];
                    
                    // Ajustar para evitar problemas com subtração e divisão
                    if (op === '-') {
                        // Garantir que num1 >= num2 para evitar negativos
                        expressionText = `${Math.max(num1, num2)} ${op} ${Math.min(num1, num2)}`;
                        result = applyOperation(Math.max(num1, num2), Math.min(num1, num2), op);
                    } else if (op === '÷') {
                        // Garantir divisão inteira: fazer num1 ser múltiplo de num2
                        const divisors = getDivisors(num1);
                        if (divisors.length > 0) {
                            const divisor = divisors[Math.floor(Math.random() * divisors.length)];
                            expressionText = `${num1} ${op} ${divisor}`;
                            result = applyOperation(num1, divisor, op);
                        } else {
                            // Se não há divisores, trocar operação
                            const newOp = operations.filter(o => o !== '÷')[0];
                            expressionText = `${num1} ${newOp} ${num2}`;
                            result = applyOperation(num1, num2, newOp);
                        }
                    } else {
                        expressionText = `${num1} ${op} ${num2}`;
                        result = applyOperation(num1, num2, op);
                    }
                } else if (exprDifficulty === 'medium') {
                    // Modo médio: 3 a 5 números, 2 a 4 operações
                    const numCount = Math.floor(Math.random() * 3) + 3; // 3, 4 ou 5
                    let numbers = [];
                    for (let i = 0; i < numCount; i++) {
                        numbers.push(getRandomNumber(numberRange.min, numberRange.max));
                    }
                    
                    // Escolher operações (pode repetir)
                    let ops = [];
                    for (let i = 0; i < numCount - 1; i++) {
                        ops.push(operations[Math.floor(Math.random() * operations.length)]);
                    }
                    
                    // Construir a expressão e calcular o resultado
                    expressionText = numbers[0].toString();
                    result = numbers[0];
                    
                    for (let i = 1; i < numCount; i++) {
                        const op = ops[i-1];
                        const nextNum = numbers[i];
                        
                        // Ajustar para evitar negativos e divisões não inteiras
                        if (op === '-' && nextNum > result) {
                            // Inverter a operação
                            expressionText = nextNum + ' - ' + expressionText;
                            result = nextNum - result;
                        } else if (op === '÷') {
                            const divisors = getDivisors(result);
                            if (divisors.length > 0) {
                                const divisor = divisors[Math.floor(Math.random() * divisors.length)];
                                expressionText += ' ÷ ' + divisor;
                                result = result / divisor;
                            } else {
                                // Trocar operação
                                const newOp = operations.filter(o => o !== '÷')[0];
                                expressionText += ' ' + newOp + ' ' + nextNum;
                                result = applyOperation(result, nextNum, newOp);
                            }
                        } else {
                            expressionText += ' ' + op + ' ' + nextNum;
                            result = applyOperation(result, nextNum, op);
                        }
                    }
                } else if (exprDifficulty === 'hard') {
                    // Modo difícil: 5 a 10 números, todas as operações, parênteses
                    const numCount = Math.floor(Math.random() * 6) + 5; // 5 a 10
                    let numbers = [];
                    for (let i = 0; i < numCount; i++) {
                        numbers.push(getRandomNumber(numberRange.min, numberRange.max));
                    }
                    
                    // Escolher operações (paka repetir)
                    let ops = [];
                    for (let i = 0; i < numCount - 1; i++) {
                        ops.push(operations[Math.floor(Math.random() * operations.length)]);
                    }
                    
                    // Construir a expressão e calcular o resultado
                    expressionText = numbers[0].toString();
                    result = numbers[0];
                    
                    for (let i = 1; i < numCount; i++) {
                        const op = ops[i-1];
                        const nextNum = numbers[i];
                        
                        // Ajustar para evitar negativos e divisões não inteiras
                        if (op === '-' && nextNum > result) {
                            // Inverter a operação
                            expressionText = nextNum + ' - ' + expressionText;
                            result = nextNum - result;
                        } else if (op === '÷') {
                            const divisors = getDivisors(result);
                            if (divisors.length > 0) {
                                const divisor = divisors[Math.floor(Math.random() * divisors.length)];
                                expressionText += ' ÷ ' + divisor;
                                result = result / divisor;
                            } else {
                                // Trocar operação
                                const newOp = operations.filter(o => o !== '÷')[0];
                                expressionText += ' ' + newOp + ' ' + nextNum;
                                result = applyOperation(result, nextNum, newOp);
                            }
                        } else {
                            expressionText += ' ' + op + ' ' + nextNum;
                            result = applyOperation(result, nextNum, op);
                        }
                    }
                    
                    // Adicionar parênteses em alguns lugares (apenas no modo difícil)
                    expressionText = addParentheses(expressionText);
                }
                
                // Arredondar o resultado
                result = Math.round(result);
                
                // Continuar tentando até que o resultado esteja dentro do intervalo definido pelo usuário
            } while ((result < resultMin || result > resultMax) && attempts < maxAttempts);
            
            // Se após várias tentativas não conseguir um resultado válido, forçar um resultado dentro do intervalo
            if (result < resultMin || result > resultMax) {
                result = getRandomNumber(resultMin, resultMax);
                // Criar uma expressão simples que resulta no número desejado
                const num1 = result;
                const num2 = getRandomNumber(1, 10);
                const op = operations[Math.floor(Math.random() * operations.length)];
                
                if (op === '+') {
                    expressionText = `${num1 - num2} + ${num2}`;
                } else if (op === '-') {
                    expressionText = `${num1 + num2} - ${num2}`;
                } else if (op === '×') {
                    // Encontrar um divisor
                    const divisors = getDivisors(num1);
                    if (divisors.length > 0) {
                        const divisor = divisors[Math.floor(Math.random() * divisors.length)];
                        expressionText = `${divisor} × ${num1 / divisor}`;
                    } else {
                        expressionText = `${num1} × 1`;
                    }
                } else if (op === '÷') {
                    expressionText = `${num1 * num2} ÷ ${num2}`;
                }
            }
            
            return {
                text: expressionText + " = ?",
                result: result
            };
        }
        
        function addParentheses(expression) {
            // Adicionar parênteses aleatoriamente na expressão (apenas para modo difícil)
            const parts = expression.split(' ');
            if (parts.length <= 3) return expression; // Não adicionar parênteses em expressões curtas
            
            // Escolher uma posição aleatória para adicionar parênteses
            const openPos = Math.floor(Math.random() * (parts.length - 3)) + 1;
            const closePos = Math.min(openPos + 4, parts.length - 1);
            
            // Inserir parênteses
            parts.splice(openPos, 0, '(');
            parts.splice(closePos + 1, 0, ')');
            
            return parts.join(' ');
        }
        
        function getRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function applyOperation(a, b, op) {
            switch(op) {
                case '+': return a + b;
                case '-': return a - b;
                case '×': return a * b;
                case '÷': return a / b;
                default: return a;
            }
        }
        
        function getDivisors(n) {
            const divisors = [];
            // Considerar apenas divisores positivos
            for (let i = 2; i <= n; i++) {
                if (n % i === 0) divisors.push(i);
            }
            return divisors;
        }
        
        function verifyNumber() {
            const input = document.getElementById('verify-number');
            const resultDiv = document.getElementById('verify-result');
            
            if (!input.value) {
                resultDiv.textContent = 'Por favor, digite um número para verificar.';
                resultDiv.className = 'verifier-result invalid';
                return;
            }
            
            const number = parseFloat(input.value);
            
            if (drawnResults.has(number)) {
                // Encontrar a expressão que gerou este resultado
                const expression = drawnExpressions.find(expr => expr.result === number);
                resultDiv.innerHTML = `✓ Este número foi sorteado!<br>Expressão: ${expression.text.replace('?', number)}`;
                resultDiv.className = 'verifier-result valid';
            } else {
                resultDiv.textContent = '✗ Este número NÃO foi sorteado.';
                resultDiv.className = 'verifier-result invalid';
            }
        }
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Atualizar a pré-visualização da cartela quando os valores mudarem
            document.getElementById('min-number').addEventListener('input', updateCardPreview);
            document.getElementById('max-number').addEventListener('input', updateCardPreview);
            
            // Inicializar a pré-visualização
            updateCardPreview();
        });
        
        function updateCardPreview() {
            const min = parseInt(document.getElementById('min-number').value) || 1;
            const max = parseInt(document.getElementById('max-number').value) || 50;
            
            if (min >= max) {
                return;
            }
            
            // Gerar uma cartela de exemplo para pré-visualização
            const card = generateBingoCard(min, max);
            const cells = document.querySelectorAll('.card-preview .card-cell');
            
            for (let i = 0; i < cells.length; i++) {
                cells[i].textContent = card[i];
                if (card[i] === 'FREE') {
                    cells[i].classList.add('free');
                } else {
                    cells[i].classList.remove('free');
                }
            }
        }
    </script>
</body>
</html>
