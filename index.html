<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Bingo Matemático</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: linear-gradient(135deg,#5dade2,#a569bd);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }
    .container {
      width: 100%;
      max-width: 1100px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      overflow: hidden;
      animation: fadeIn .5s ease-in;
    }
    @keyframes fadeIn {from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
    header {
      background: #8e44ad;
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    header h1 {margin:0;font-size:1.8rem}
    .content {padding: 20px;}
    .screen {display:none}
    .screen.active {display:block}
    .btn {
      background: #8e44ad;
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: .2s;
    }
    .btn:hover {background:#6c3483}
    .btn.secondary {background:#27ae60}
    .btn.secondary:hover{background:#1e8449}
    .btn.ghost{background:#fff;border:1px solid #ccc;color:#444}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    label{font-weight:600;display:block;margin-top:10px}
    input,select{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc}
    .history{background:#fafafa;border:1px solid #ddd;border-radius:8px;padding:10px;
      max-height:200px;overflow-y:auto;margin-top:12px}
    .expression{font-size:1.4rem;font-weight:700;color:#8e44ad;margin:20px 0}
    footer{text-align:center;font-size:.8rem;color:#666;padding:12px}
    .check-area{margin-top:15px;padding:10px;border:1px solid #ddd;border-radius:8px;background:#f4f4f4}
    .timer-box{margin-top:15px;padding:10px;background:#eef;border-radius:8px}
  </style>
</head>
<body>
  <div class="container">
    <header><h1>Bingo Matemático</h1></header>
    <div class="content">

      <!-- HOME -->
      <div id="home" class="screen active">
        <h2>Menu</h2>
        <div class="controls">
          <button class="btn" data-target="generate">Gerar Cartela</button>
          <button class="btn secondary" data-target="config">Começar Sorteio</button>
        </div>
      </div>

      <!-- GERAÇÃO CARTELAS -->
      <div id="generate" class="screen">
        <h2>Gerar Cartelas</h2>
        <label>Min:</label><input id="min-number" type="number" value="1"/>
        <label>Max:</label><input id="max-number" type="number" value="50"/>
        <label>Tamanho:</label>
        <select id="grid-size"><option value="3">3x3</option><option value="5" selected>5x5</option><option value="7">7x7</option></select>
        <label>Qtd Cartelas:</label><input id="card-count" type="number" value="4"/>
        <div class="controls">
          <button class="btn" id="btn-generate">Gerar</button>
          <button class="btn ghost" data-target="home">Voltar</button>
        </div>
        <div id="generated-area" style="margin-top:20px;display:none">
          <h3>Cartelas geradas</h3>
          <div id="pdf-preview"></div>
          <div class="controls">
            <button class="btn secondary" id="btn-pdf">Gerar PDF</button>
          </div>
        </div>
      </div>

      <!-- CONFIGURAÇÃO SORTEIO -->
      <div id="config" class="screen">
        <h2>Configurações</h2>
        <label>Dificuldade:</label>
        <select id="difficulty">
          <option value="easy">Fácil</option>
          <option value="normal">Normal</option>
          <option value="hard">Difícil</option>
        </select>
        <label>Intervalo de números usados nas expressões:</label>
        <select id="expr-range">
          <option value="100">1 a 100</option>
          <option value="300">1 a 300</option>
          <option value="500">1 a 500</option>
        </select>
        <label>Intervalo de sorteio (resultados esperados):</label>
        <input id="draw-min" type="number" value="1"/> até
        <input id="draw-max" type="number" value="100"/>
        <label>Operações:</label>
        <div>
          <label><input type="checkbox" id="op-add" checked>+</label>
          <label><input type="checkbox" id="op-sub" checked>-</label>
          <label><input type="checkbox" id="op-mul">×</label>
          <label><input type="checkbox" id="op-div">÷</label>
        </div>
        <h3>Timers</h3>
        <label>Intervalo automático de sorteio (segundos, 0 = desativado):</label>
        <input type="number" id="auto-interval" value="0"/>
        <label>Cronômetro regressivo (minutos, 0 = sem limite):</label>
        <input type="number" id="countdown" value="0"/>
        <div class="controls">
          <button class="btn secondary" onclick="startGame()">Iniciar Sorteio</button>
          <button class="btn ghost" data-target="home">Voltar</button>
        </div>
      </div>

      <!-- SORTEIO -->
      <div id="draw" class="screen">
        <h2>Sorteio em andamento</h2>
        <div class="expression" id="current-expression">Clique em "Sortear expressão"</div>
        <div class="controls">
          <button class="btn" onclick="drawExpression()">Sortear expressão</button>
          <button class="btn secondary" onclick="clearDraws()">Limpar sorteio</button>
          <button class="btn ghost" data-target="home" onclick="stopTimers()">Encerrar</button>
        </div>
        <div class="timer-box">
          <strong>Cronômetro:</strong> <span id="countdown-display">--:--</span>
        </div>
        <h3>Histórico</h3>
        <div id="history" class="history"></div>

        <div class="check-area">
          <h3>Verificar Cartelas</h3>
          <label>Digite um número:</label>
          <input type="number" id="check-number"/>
          <button class="btn" onclick="checkNumber()">Verificar</button>
          <div id="check-result"></div>
        </div>
      </div>

    </div>
    <footer>Bingo Matemático © 2025</footer>
  </div>

  <script>
    let generatedCards = [];
    let expressions = [];
    let results = new Set();
    let autoTimer=null, countdownTimer=null, timeLeft=0;

    document.querySelectorAll("[data-target]").forEach(btn=>{
      btn.addEventListener("click",()=>showScreen(btn.getAttribute("data-target")));
    });
    function showScreen(id){
      document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    // Cartelas
    function generateCard(min,max,size){
      const set=new Set();
      while(set.size<size*size){set.add(getRandom(min,max))}
      return [...set];
    }
    document.getElementById("btn-generate").onclick=()=>{
      const min=parseInt(document.getElementById("min-number").value);
      const max=parseInt(document.getElementById("max-number").value);
      const size=parseInt(document.getElementById("grid-size").value);
      const count=parseInt(document.getElementById("card-count").value);
      generatedCards=[];
      for(let i=0;i<count;i++){generatedCards.push(generateCard(min,max,size))}
      renderPreview();
      document.getElementById("generated-area").style.display="block";
    };
    function renderPreview(){
      const prev=document.getElementById("pdf-preview");
      prev.innerHTML="";
      generatedCards.forEach((c,i)=>{
        const div=document.createElement("div");
        div.style.marginBottom="10px";
        div.textContent="Cartela "+(i+1)+": "+c.join(", ");
        prev.appendChild(div);
      });
    }
    document.getElementById("btn-pdf").onclick=()=>{
      const {jsPDF}=window.jspdf;
      const doc=new jsPDF();
      generatedCards.forEach((c,i)=>{
        doc.text("Cartela "+(i+1)+": "+c.join(", "),10,20+10*i);
      });
      doc.save("cartelas.pdf");
    };

    // Sorteio
    function startGame(){
      expressions=[]; results=new Set();
      document.getElementById("history").innerHTML="";
      document.getElementById("current-expression").textContent="Clique em 'Sortear expressão'";
      showScreen("draw");
      stopTimers();

      // Auto timer
      const autoInt=parseInt(document.getElementById("auto-interval").value);
      if(autoInt>0){
        autoTimer=setInterval(()=>{drawExpression()},autoInt*1000);
      }

      // Countdown
      const mins=parseInt(document.getElementById("countdown").value);
      if(mins>0){
        timeLeft=mins*60;
        updateCountdown();
        countdownTimer=setInterval(()=>{
          timeLeft--;
          updateCountdown();
          if(timeLeft<=0){
            stopTimers();
            alert("Tempo encerrado!");
          }
        },1000);
      }else{
        document.getElementById("countdown-display").textContent="--:--";
      }
    }

    function stopTimers(){
      if(autoTimer) clearInterval(autoTimer);
      if(countdownTimer) clearInterval(countdownTimer);
      autoTimer=null; countdownTimer=null;
    }
    function updateCountdown(){
      const m=Math.floor(timeLeft/60);
      const s=timeLeft%60;
      document.getElementById("countdown-display").textContent=`${m}:${s.toString().padStart(2,"0")}`;
    }

    function drawExpression(){
      const difficulty=document.getElementById("difficulty").value;
      const exprRange=parseInt(document.getElementById("expr-range").value);
      const drawMin=parseInt(document.getElementById("draw-min").value);
      const drawMax=parseInt(document.getElementById("draw-max").value);

      let expr="",val=0,tries=0;
      do{
        [expr,val]=generateExpression(difficulty,exprRange);
        tries++;
        if(tries>50){alert("Não foi possível gerar expressão única.");return;}
      }while(results.has(val) || expressions.includes(expr) || val<drawMin || val>drawMax);

      results.add(val); expressions.push(expr);
      document.getElementById("current-expression").textContent=expr;
      const hist=document.getElementById("history");
      const p=document.createElement("div");
      p.textContent=expr+" = (?)";
      hist.prepend(p);
    }

    function clearDraws(){
      expressions=[]; results=new Set();
      document.getElementById("history").innerHTML="";
      document.getElementById("current-expression").textContent="Clique em 'Sortear expressão'";
    }

    function generateExpression(level,range){
      const ops=[]; if(opAdd())ops.push("+"); if(opSub())ops.push("-"); if(opMul())ops.push("*"); if(opDiv())ops.push("/");
      const count=ops.length||1;
      let nOps=1,nums=2;
      if(level==="easy"){nums=2;nOps=1;}
      if(level==="normal"){nums=getRandom(2,5);nOps=Math.min(3,count);}
      if(level==="hard"){nums=getRandom(5,10);nOps=Math.min(4,count);}
      const numbers=Array.from({length:nums},()=>getRandom(1,range));
      let expr=numbers[0].toString();
      for(let i=1;i<nums;i++){
        const op=ops[getRandom(0,count-1)];
        expr+=" "+op+" "+numbers[i];
      }
      if(level==="hard" && Math.random()<0.4){
        expr="("+expr+")";
      }
      let val;
      try{val=eval(expr);}catch{val=NaN;}
      return [expr,Math.round(val)];
    }

    function opAdd(){return document.getElementById("op-add").checked}
    function opSub(){return document.getElementById("op-sub").checked}
    function opMul(){return document.getElementById("op-mul").checked}
    function opDiv(){return document.getElementById("op-div").checked}

    function checkNumber(){
      const n=parseInt(document.getElementById("check-number").value);
      if(!generatedCards.length){document.getElementById("check-result").textContent="Nenhuma cartela foi gerada.";return;}
      let found=false;
      generatedCards.forEach(c=>{if(c.includes(n)) found=true;});
      document.getElementById("check-result").textContent=found?"Número presente em alguma cartela.":"Número não encontrado.";
    }

    function getRandom(min,max){return Math.floor(Math.random()*(max-min+1))+min}
  </script>
</body>
</html>
